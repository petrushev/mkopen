{% extends 'extended_base.html' %}
{% import 'macros.html' as macros %}

{% block title %}{{entry.catalog_id[-1]|e}} - {{super()}}{% endblock %}

{% block meta_desc %}
  {{super()}}
    Прелистување на податочен сет:
    {{entry.catalog_id[-1]|e}}
{% endblock %}

{% block main %}
<div itemscope id="entry" itemprop="dataset" itemtype="http://schema.org/Dataset">
  <h3 itemprop="headline">{{entry.catalog_id[-1]|e}}</h3>

  {# microdata #}
  <meta itemprop="dateCreated" content="{{entry.created|date_format}}" />
  <meta itemprop="dateModified" content="{{entry.modified|date_format}}" />

  <div class="row">

    <div id="history" class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
      <p>Историја</p>
      {% for version in versions %}
        <p itemprop="distribution" itemscope itemtype="http://schema.org/DataDownload">
          <span>{{ version.updated|date_format }}</span>

          {# microdata #}
          <meta itemprop="contentUrl" content="/download/{{version.id|uuid2b64}}" />
          <meta itemprop="version" content="{{loop.revindex}}" />
          {% if version.metadata.file_type %}
            {% if version.metadata.file_type == 'csv' %}
	          <meta itemprop="fileFormat" content="text/csv" />
            {% endif %}
          {% endif %}

          <a href="/download/{{version.id|uuid2b64}}" >
	        <span class="glyphicon glyphicon-download-alt" aria-hidden="true">
	          {% if version.metadata.file_type %}
	            .{{version.metadata.file_type|e}}
	          {% else %}
	            преземи
	          {% endif %}
	        </span>
	      </a>
	      {% if not loop.last %}
            - <a href="/diff/{{version.id|uuid2b64}}" >спореди</a>
          {% endif %}
	    </p>
      {% endfor %}
    </div>

    <div id="info" class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
      <div  itemscope itemtype="http://schema.org/DataCatalog" itemref="entry">
        {% set catalog_filter = ( entry.catalog_id[:-1]|join('/') ) %}
        <meta itemprop="url" content="/search?catalog={{catalog_filter}}" />

        <p>Каталог</p>
        <span itemprop="headline" >
        {% for cat in (entry.catalog_id[:-1]) %}
          {% set catalog_filter = ( entry.catalog_id[:loop.index]|join('/') ) %}
          <a href="/search?catalog={{url_quote(catalog_filter)}}" >{{cat|e}}</a>
          {% if not loop.last %}{{'>'}}{% endif %}
        {% endfor %}
        </span>

      </div> {# catalog info #}

      {% if entry.last.metadata.file_type == 'csv' %}
        {% set cols = entry.last.columns() %}
        {% if cols %}
          <hr/>
          <div id="csv_columns" >
            <p>Колони:</p>
            <p>{{cols|join(', ')}}</p>
        {% endif %}
      {% endif %}


    </div> {# info widget #}

  </div>
</div>


{% endblock %}
